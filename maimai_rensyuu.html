<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YouTube Landscape Player</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 800px;
            text-align: center;
            box-sizing: border-box;
        }
        
        /* å…¥åŠ›ã‚¨ãƒªã‚¢ */
        .input-group {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        input[type="text"] {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            min-width: 200px;
        }
        
        /* ãƒœã‚¿ãƒ³å…±é€š */
        button {
            padding: 10px 20px;
            background-color: #ff0000;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }
        button:hover { opacity: 0.9; }

        /* å‹•ç”»ã‚³ãƒ³ãƒ†ãƒŠ */
        .video-wrapper {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 */
            height: 0;
            background: #000;
            margin-bottom: 20px;
            z-index: 1;
            transition: all 0.3s ease;
        }
        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* --- å…¨ç”»é¢ãƒ»æ¨ªå‘ãåˆ¶å¾¡ --- */

        /* å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰ (Android/PC) */
        .video-wrapper.is-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            padding-bottom: 0;
            margin: 0;
            z-index: 9999;
        }

        /* å¼·åˆ¶æ¨ªå‘ããƒ¢ãƒ¼ãƒ‰ (iPhoneç¸¦æŒã¡ç”¨) 
           ç”»é¢ã®ä¸­å¤®ã‚’è»¸ã«90åº¦å›è»¢ã•ã›ã€å¹…ã¨é«˜ã•ã‚’å…¥ã‚Œæ›¿ãˆã¾ã™ */
        .video-wrapper.force-landscape {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 100vh;  /* æ¨ªå¹…ï¼ç”»é¢ã®é«˜ã• */
            height: 100vw; /* é«˜ã•ï¼ç”»é¢ã®å¹… */
            padding-bottom: 0;
            margin: 0;
            z-index: 9999;
            transform: translate(-50%, -50%) rotate(90deg);
        }

        /* å…¨ç”»é¢æ™‚ã®ã¿è¡¨ç¤ºã™ã‚‹UIç¾¤ */
        .fs-ui {
            display: none; 
            position: absolute;
            z-index: 2147483647; /* æœ€å‰é¢ */
        }

        /* 
           å·¦ä¸Šã®å›ºå®š/è§£é™¤ãƒœã‚¿ãƒ³ 
           é€šå¸¸æ™‚ã¨ã€å¼·åˆ¶å›è»¢æ™‚ã§é…ç½®ã‚’èª¿æ•´
        */
        #lockControlBtn {
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.8);
            color: #333;
            border: 1px solid #ccc;
            border-radius: 30px;
            padding: 8px 20px;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }

        /* â–¼â–¼â–¼ è¿½åŠ ï¼šãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« â–¼â–¼â–¼ */
        #homeBtn {
            top: 80px; /* å›ºå®šãƒœã‚¿ãƒ³ã®ä¸‹ã«é…ç½® */
            left: 20px;
            background: rgba(255, 255, 255, 0.8);
            color: #333;
            border: 1px solid #ccc;
            border-radius: 30px;
            padding: 8px 20px;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        /* â–²â–²â–² è¿½åŠ ã“ã“ã¾ã§ â–²â–²â–² */

        /* iPhoneå¼·åˆ¶å›è»¢æ™‚ã¯ãƒœã‚¿ãƒ³ã®å‘ãã‚‚æˆ»ã™å¿…è¦ã‚ã‚Š */
        .video-wrapper.force-landscape #lockControlBtn {
            /* è¦‹ãŸç›®ä¸Šã®ã€Œå·¦ä¸Šã€ã«é…ç½®ã™ã‚‹ãŸã‚ã«åº§æ¨™å¤‰æ› */
            top: auto; 
            bottom: 30px; 
            left: 30px;
            transform: rotate(-90deg); /* æ–‡å­—ã®å‘ãã‚’æˆ»ã™ */
            transform-origin: center;
        }

        /* â–¼â–¼â–¼ è¿½åŠ ï¼šå¼·åˆ¶å›è»¢æ™‚ã®ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³é…ç½® â–¼â–¼â–¼ */
        .video-wrapper.force-landscape #homeBtn {
            top: auto;
            bottom: 30px;
            left: 110px; /* å›ºå®šãƒœã‚¿ãƒ³ã‚ˆã‚Šç”»é¢ä¸‹æ–¹å‘ã«ãšã‚‰ã™ */
            transform: rotate(-90deg);
            transform-origin: center;
        }
        /* â–²â–²â–² è¿½åŠ ã“ã“ã¾ã§ â–²â–²â–² */

        /* ãƒ­ãƒƒã‚¯ç”¨é€æ˜ãƒ¬ã‚¤ãƒ¤ãƒ¼ */
        #touchBlocker {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2147483646; 
            background: rgba(0,0,0,0);
        }

        /* UIè¡¨ç¤ºã‚¹ã‚¤ãƒƒãƒ */
        .video-wrapper.is-fullscreen .fs-ui,
        .video-wrapper.force-landscape .fs-ui {
            display: block;
        }


        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ */
        .controls {
            padding: 15px;
            background: #eee;
            border-radius: 8px;
            width: 100%;
            box-sizing: border-box;
        }
        .speed-display {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
        }
        input[type=range] {
            width: 100%;
            height: 30px;
            cursor: pointer;
        }
        .labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            color: #666;
        }
        
        .fs-btn {
            background-color: #333;
            width: 100%;
            margin-top: 15px;
            padding: 15px;
            font-size: 16px;
        }
    </style>
</head>
<body>

<div class="container">
    <h3>YouTube æ¨ªå‘ãå†ç”Ÿãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</h3>
    <a href="https://m.youtube.com/" target="_blank" style="display: inline-block; transform: translateY(-10px);">YouTube</a>

    <div class="input-group">
        <input type="text" id="urlInput" placeholder="URLã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘" />
        <button onclick="loadVideoFromInput()">èª­è¾¼</button>
    </div>

    <!-- å‹•ç”»ã‚¨ãƒªã‚¢ -->
    <div class="video-wrapper" id="videoWrapper">
        <div id="player"></div>
        
        <!-- å…¨ç”»é¢æ™‚ãƒœã‚¿ãƒ³ -->
        <button id="lockControlBtn" class="fs-ui" onclick="toggleLockState()">ğŸ”’ å›ºå®š</button>
        <!-- â–¼â–¼â–¼ è¿½åŠ ï¼šãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ â–¼â–¼â–¼ -->
        <button id="homeBtn" class="fs-ui" onclick="exitFullscreenLandscape()">ğŸ  ãƒ›ãƒ¼ãƒ </button>
        
        <!-- ãƒ­ãƒƒã‚¯ç”¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
        <div id="touchBlocker"></div>
    </div>

    <div class="controls">
        <span class="speed-display">é€Ÿåº¦: <span id="speedValue">1.0</span>x</span>
        <input type="range" id="speedRange" min="0.1" max="2.0" step="0.1" value="1.0">
        <div class="labels">
            <span>0.1x</span>
            <span>1.0x</span>
            <span>2.0x</span>
        </div>
        
        <button class="fs-btn" onclick="enterFullscreenLandscape()">å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰ã§è¦‹ã‚‹ï¼ˆæ¨ªå‘ãï¼‰</button>
        <p style="font-size:0.8em; color:#666; margin-top:5px;">
            â€»æŠ¼ã™ã¨æ¨ªå‘ãå…¨ç”»é¢ã«ãªã‚Šã¾ã™ã€‚<br>å·¦ä¸Šã®ã€Œå›ºå®šã€ã‚’æŠ¼ã™ã¨ã‚¿ãƒƒãƒç„¡åŠ¹ã«ãªã‚Šã¾ã™ã€‚
        </p>
    </div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
    let player;
    const speedRange = document.getElementById('speedRange');
    const speedValue = document.getElementById('speedValue');
    const videoWrapper = document.getElementById('videoWrapper');
    const lockControlBtn = document.getElementById('lockControlBtn');
    const touchBlocker = document.getElementById('touchBlocker');
    
    let isLocked = false;

    function onYouTubeIframeAPIReady() { console.log("API Ready"); }

    function extractVideoID(url) {
        if (!url) return false;
        url = url.trim();
        const regExp = /^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=|shorts\/|live\/)([^#\&\?]*).*/;
        const match = url.match(regExp);
        return (match && match[2].length === 11) ? match[2] : false;
    }

    function loadVideoFromInput() {
        const url = document.getElementById('urlInput').value;
        const videoId = extractVideoID(url);
        
        if (!videoId) { 
            alert("URLã‚’ç¢ºèªã—ã¦ãã ã•ã„\n(YouTubeã®URLå½¢å¼ãŒèªè­˜ã§ãã¾ã›ã‚“ã§ã—ãŸ)"); 
            return; 
        }

        if (player) {
            player.loadVideoById({ 'videoId': videoId, 'suggestedQuality': 'hd1080' });
        } else {
            player = new YT.Player('player', {
                height: '100%',
                width: '100%',
                videoId: videoId,
                // â–¼â–¼â–¼ ä¿®æ­£ï¼šfs:0 ã‚’è¿½åŠ ã—ã¦ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã« â–¼â–¼â–¼
                playerVars: { 'playsinline': 1, 'rel': 0, 'vq': 'hd1080', 'fs': 0 },
                events: { 'onReady': onPlayerReady }
            });
        }
    }

    function onPlayerReady(event) {
        event.target.setPlaybackQuality('hd1080');
        setSpeed(speedRange.value);
    }

    function setSpeed(val) {
        const rate = parseFloat(val);
        speedValue.innerText = rate.toFixed(1);
        if (player && typeof player.setPlaybackRate === 'function') {
            player.setPlaybackRate(rate);
        }
    }

    speedRange.addEventListener('input', function() {
        setSpeed(this.value);
    });

    // --- å…¨ç”»é¢ï¼†æ¨ªå‘ãåˆ¶å¾¡ ---

    async function enterFullscreenLandscape() {
        // 1. ã¾ãšå…¨ç”»é¢åŒ–ã‚’è©¦ã¿ã‚‹
        if (document.documentElement.requestFullscreen) {
            try {
                await document.documentElement.requestFullscreen();
            } catch (e) { console.log("FS allowed but failed or iOS"); }
        }

        // 2. ç”»é¢ã®å‘ãã‚’åˆ¤å®šã—ã¦å‡¦ç†ã‚’åˆ†ã‘ã‚‹
        if (screen.orientation && screen.orientation.lock) {
            // Androidç­‰: ãƒã‚¤ãƒ†ã‚£ãƒ–APIã§æ¨ªå›ºå®š
            screen.orientation.lock('landscape').then(() => {
                videoWrapper.classList.add('is-fullscreen');
            }).catch((err) => {
                // ãƒ­ãƒƒã‚¯å¤±æ•—ã—ãŸã‚‰CSSå¼·åˆ¶ãƒ¢ãƒ¼ãƒ‰ã¸
                enableForceLandscape();
            });
        } else {
            // iPhone (iOS Safari) ç­‰: APIãŒãªã„ã®ã§CSSã§å›è»¢
            enableForceLandscape();
        }
    }

    function enableForceLandscape() {
        if (window.innerWidth > window.innerHeight) {
            videoWrapper.classList.add('is-fullscreen');
        } else {
            videoWrapper.classList.add('force-landscape');
        }
    }

    // â–¼â–¼â–¼ è¿½åŠ ï¼šãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ç”¨ã®å…¨ç”»é¢è§£é™¤é–¢æ•° â–¼â–¼â–¼
    function exitFullscreenLandscape() {
        // ãƒ–ãƒ©ã‚¦ã‚¶ã®å…¨ç”»é¢APIã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã®è§£é™¤
        if (document.fullscreenElement || document.webkitIsFullScreen) {
            if (document.exitFullscreen) {
                document.exitFullscreen().catch(err => console.log(err));
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            }
        }
        
        // CSSã‚¯ãƒ©ã‚¹ã‚„ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã‚’å¼·åˆ¶çš„ã«è§£é™¤
        // (APIè§£é™¤ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ãªã„å ´åˆã‚„ã€CSSå¼·åˆ¶ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã®ãŸã‚)
        videoWrapper.classList.remove('is-fullscreen');
        videoWrapper.classList.remove('force-landscape');
        unlock(); // ã‚¿ãƒƒãƒãƒ­ãƒƒã‚¯ã‚‚è§£é™¤
        
        if (screen.orientation && screen.orientation.unlock) {
            screen.orientation.unlock();
        }
    }
    // â–²â–²â–² è¿½åŠ ã“ã“ã¾ã§ â–²â–²â–²

    // å…¨ç”»é¢è§£é™¤æ™‚ã®ãƒªã‚»ãƒƒãƒˆå‡¦ç†
    function exitHandler() {
        if (!document.fullscreenElement && !document.webkitIsFullScreen) {
            // å…¨ç”»é¢ã‹ã‚‰æˆ»ã£ãŸã‚‰ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è§£é™¤
            videoWrapper.classList.remove('is-fullscreen');
            videoWrapper.classList.remove('force-landscape');
            unlock(); // ãƒ­ãƒƒã‚¯ã‚‚è§£é™¤
            
            // å‘ããƒ­ãƒƒã‚¯è§£é™¤ (Androidç”¨)
            if (screen.orientation && screen.orientation.unlock) {
                screen.orientation.unlock();
            }
        }
    }

    document.addEventListener('fullscreenchange', exitHandler);
    document.addEventListener('webkitfullscreenchange', exitHandler);

    // --- ã‚¿ãƒƒãƒãƒ­ãƒƒã‚¯åˆ¶å¾¡ ---

    function toggleLockState() {
        if (isLocked) {
            unlock();
        } else {
            lock();
        }
    }

    function lock() {
        isLocked = true;
        touchBlocker.style.display = 'block'; 
        lockControlBtn.innerText = 'ğŸ”“ è§£é™¤'; 
        lockControlBtn.style.backgroundColor = 'rgba(255, 200, 200, 0.9)'; 
    }

    function unlock() {
        isLocked = false;
        touchBlocker.style.display = 'none'; 
        lockControlBtn.innerText = 'ğŸ”’ å›ºå®š'; 
        lockControlBtn.style.backgroundColor = 'rgba(255, 255, 255, 0.8)';
    }

</script>

</body>
</html>
