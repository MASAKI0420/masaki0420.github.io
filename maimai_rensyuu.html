<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YouTube Landscape Player</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 800px;
            text-align: center;
            box-sizing: border-box;
        }
        
        /* å…¥åŠ›ã‚¨ãƒªã‚¢ */
        .input-group {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        input[type="text"] {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            min-width: 200px;
        }
        
        /* ãƒœã‚¿ãƒ³å…±é€š */
        button {
            padding: 10px 20px;
            background-color: #ff0000;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }
        button:hover { opacity: 0.9; }

        /* å‹•ç”»ã‚³ãƒ³ãƒ†ãƒŠ */
        .video-wrapper {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 */
            height: 0;
            background: #000;
            margin-bottom: 20px;
            z-index: 1;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* --- å…¨ç”»é¢ãƒ»æ¨ªå‘ãåˆ¶å¾¡ --- */

        /* å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰ (Android/PC) */
        .video-wrapper.is-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            padding-bottom: 0;
            margin: 0;
            z-index: 9999;
        }

        /* å¼·åˆ¶æ¨ªå‘ããƒ¢ãƒ¼ãƒ‰ (iPhoneç¸¦æŒã¡ç”¨) */
        .video-wrapper.force-landscape {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 100vh;  /* æ¨ªå¹…ï¼ç”»é¢ã®é«˜ã• */
            height: 100vw; /* é«˜ã•ï¼ç”»é¢ã®å¹… */
            padding-bottom: 0;
            margin: 0;
            z-index: 9999;
            transform: translate(-50%, -50%) rotate(90deg);
        }

        /* å…¨ç”»é¢æ™‚ã®ã¿è¡¨ç¤ºã™ã‚‹UIç¾¤ (åˆæœŸå€¤:éè¡¨ç¤º) */
        .fs-ui {
            display: none; 
            position: absolute;
            z-index: 2147483647; /* æœ€å‰é¢ */
        }

        /* å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã¿è¡¨ç¤ºã‚’ON */
        .video-wrapper.is-fullscreen .fs-ui,
        .video-wrapper.force-landscape .fs-ui {
            display: block;
        }

        /* UIå…±é€šã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆå·¦ä¸Šã®ãƒœã‚¿ãƒ³é¡ï¼‰ */
        .ui-btn {
            background: rgba(255, 255, 255, 0.8);
            color: #333;
            border: 1px solid #ccc;
            border-radius: 30px;
            padding: 8px 10px;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            width: 120px;
        }

        /* å·¦ä¸Šã®å›ºå®š/è§£é™¤ãƒœã‚¿ãƒ³ */
        #lockControlBtn {
            top: 20px;
            left: 20px;
        }

        /* ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ */
        #homeBtn {
            top: 80px; 
            left: 20px;
        }

        /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ã‚³ãƒ³ãƒ†ãƒŠ */
        #sliderWrapper {
            position: absolute; /* è¦ªã‚’çµ¶å¯¾é…ç½®ã« */
            top: 150px; 
            left: 40px; 
            width: 80px;
            height: 150px;
            display: none; 
            justify-content: center;
            align-items: center;
            /* pointer-events: none; ã‚’å¤–ã™ï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ“ä½œã®ãŸã‚ï¼‰ */
        }
        
        /* å…¨ç”»é¢æ™‚ã®ã¿flexè¡¨ç¤º */
        .video-wrapper.is-fullscreen #sliderWrapper,
        .video-wrapper.force-landscape #sliderWrapper {
            display: flex;
        }

        /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æœ¬ä½“ï¼ˆç¸¦å‘ãï¼‰ */
        input[type=range].vertical-slider {
            -webkit-appearance: none;
            width: 140px; 
            height: 8px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 5px;
            outline: none;
            transform: rotate(-90deg);
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            cursor: pointer;
        }
        /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ã¤ã¾ã¿ï¼ˆé’è‰²ï¼‰ */
        input[type=range].vertical-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #007bff; /* é’è‰² */
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 2px rgba(0,0,0,0.3);
        }
        input[type=range].vertical-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #007bff;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 2px rgba(0,0,0,0.3);
        }

        /* â–¼â–¼â–¼ è¿½åŠ ï¼šã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ¨ªã®æ•°å€¤è¡¨ç¤º â–¼â–¼â–¼ */
        #sliderValueDisplay {
            position: absolute;
            left: 55px; /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å³å´ã«é…ç½® */
            bottom: 50%; /* JSã§å‹•çš„ã«å¤‰æ›´ã•ã‚Œã¾ã™ */
            transform: translateY(50%);
            color: white; /* æ–‡å­—è‰²ï¼šç™½ */
            font-weight: bold;
            font-size: 18px;
            text-shadow: 0 0 4px rgba(0,0,0,0.8); /* è¦‹ã‚„ã™ãã™ã‚‹ãŸã‚ã®å½± */
            opacity: 0; /* æœ€åˆã¯éè¡¨ç¤º */
            transition: opacity 0.2s ease;
            pointer-events: none; /* ã‚¿ãƒƒãƒã®é‚ªé­”ã«ãªã‚‰ãªã„ã‚ˆã†ã« */
            white-space: nowrap;
        }
        /* â–²â–²â–² è¿½åŠ ã“ã“ã¾ã§ â–²â–²â–² */


        /* --- iPhoneå¼·åˆ¶å›è»¢æ™‚ã®é…ç½®èª¿æ•´ --- */

        .video-wrapper.force-landscape #lockControlBtn {
            top: auto; 
            bottom: 30px; 
            left: 30px;
            transform: rotate(-90deg);
            transform-origin: center;
        }

        .video-wrapper.force-landscape #homeBtn {
            top: auto;
            bottom: 30px;
            left: 160px; 
            transform: rotate(-90deg);
            transform-origin: center;
        }

        .video-wrapper.force-landscape #sliderWrapper {
            top: auto;
            bottom: 30px;
            left: 280px; 
            transform: rotate(-90deg); 
            transform-origin: center;
        }


        /* ãƒ­ãƒƒã‚¯ç”¨é€æ˜ãƒ¬ã‚¤ãƒ¤ãƒ¼ */
        #touchBlocker {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2147483646; 
            background: rgba(0,0,0,0);
        }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ */
        .controls {
            padding: 15px;
            background: #eee;
            border-radius: 8px;
            width: 100%;
            box-sizing: border-box;
        }
        .speed-display {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
        }
        input[type=range].speed-range {
            width: 100%;
            height: 30px;
            cursor: pointer;
        }
        .labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            color: #666;
        }
        
        .fs-btn {
            background-color: #333;
            width: 100%;
            margin-top: 15px;
            padding: 15px;
            font-size: 16px;
        }
    </style>
</head>
<body>

<div class="container">
    <h3>YouTube æ¨ªå‘ãå†ç”Ÿãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</h3>
    <a href="https://m.youtube.com/" target="_blank" style="display: inline-block; transform: translateY(-10px);">YouTube</a>

    <div class="input-group">
        <input type="text" id="urlInput" placeholder="URLã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘" />
        <button onclick="loadVideoFromInput()">èª­è¾¼</button>
    </div>

    <!-- å‹•ç”»ã‚¨ãƒªã‚¢ -->
    <div class="video-wrapper" id="videoWrapper">
        <div id="player"></div>
        
        <!-- å…¨ç”»é¢UI -->
        <button id="lockControlBtn" class="fs-ui ui-btn" onclick="toggleLockState()">ğŸ”’ å›ºå®š</button>
        <button id="homeBtn" class="fs-ui ui-btn" onclick="exitFullscreenLandscape()">ğŸ  ãƒ›ãƒ¼ãƒ </button>
        
        <!-- ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚¨ãƒªã‚¢ -->
        <div id="sliderWrapper" class="fs-ui">
            <!-- é€Ÿåº¦: 0.25x ã€œ 2.0x -->
            <input type="range" id="overlaySpeedRange" class="vertical-slider" min="0.25" max="2.0" step="0.05" value="1.0">
            <!-- â–¼â–¼â–¼ è¿½åŠ ï¼šæ•°å€¤è¡¨ç¤ºç”¨ã®è¦ç´  â–¼â–¼â–¼ -->
            <div id="sliderValueDisplay">1.0x</div>
        </div>
        
        <!-- ãƒ­ãƒƒã‚¯ç”¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
        <div id="touchBlocker"></div>
    </div>

    <div class="controls">
        <span class="speed-display">é€Ÿåº¦: <span id="speedValue">1.0</span>x</span>
        
        <input type="range" id="mainSpeedRange" class="speed-range" min="0.25" max="2.0" step="0.05" value="1.0">
        
        <div class="labels">
            <span>0.25x</span>
            <span>1.0x</span>
            <span>2.0x</span>
        </div>
        
        <button class="fs-btn" onclick="enterFullscreenLandscape()">å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰ã§è¦‹ã‚‹ï¼ˆæ¨ªå‘ãï¼‰</button>
        <p style="font-size:0.8em; color:#666; margin-top:5px;">
            â€»æŠ¼ã™ã¨æ¨ªå‘ãå…¨ç”»é¢ã«ãªã‚Šã¾ã™ã€‚<br>å…¨ç”»é¢æ™‚ã€å·¦å´ã®ãƒãƒ¼ã§å†ç”Ÿé€Ÿåº¦ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚
        </p>
    </div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
    let player;
    
    // UIè¦ç´ ã®å–å¾—
    const mainSpeedRange = document.getElementById('mainSpeedRange'); 
    const overlaySpeedRange = document.getElementById('overlaySpeedRange');
    const speedValue = document.getElementById('speedValue'); 
    
    // è¿½åŠ ï¼šæ•°å€¤è¡¨ç¤ºç”¨ã®è¦ç´ 
    const sliderValueDisplay = document.getElementById('sliderValueDisplay');
    let tooltipTimer = null;
    
    const videoWrapper = document.getElementById('videoWrapper');
    const lockControlBtn = document.getElementById('lockControlBtn');
    const touchBlocker = document.getElementById('touchBlocker');
    
    let isLocked = false;

    function onYouTubeIframeAPIReady() { console.log("API Ready"); }

    function extractVideoID(url) {
        if (!url) return false;
        url = url.trim();
        const regExp = /^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=|shorts\/|live\/)([^#\&\?]*).*/;
        const match = url.match(regExp);
        return (match && match[2].length === 11) ? match[2] : false;
    }

    function loadVideoFromInput() {
        const url = document.getElementById('urlInput').value;
        const videoId = extractVideoID(url);
        
        if (!videoId) { 
            alert("URLã‚’ç¢ºèªã—ã¦ãã ã•ã„\n(YouTubeã®URLå½¢å¼ãŒèªè­˜ã§ãã¾ã›ã‚“ã§ã—ãŸ)"); 
            return; 
        }

        if (player) {
            player.loadVideoById({ 'videoId': videoId, 'suggestedQuality': 'hd1080' });
        } else {
            player = new YT.Player('player', {
                height: '100%',
                width: '100%',
                videoId: videoId,
                playerVars: { 'playsinline': 1, 'rel': 0, 'vq': 'hd1080', 'fs': 0 },
                events: { 'onReady': onPlayerReady }
            });
        }
    }

    function onPlayerReady(event) {
        event.target.setPlaybackQuality('hd1080');
        setSpeed(mainSpeedRange.value, false); // åˆæœŸåŒ–æ™‚ã¯Tooltipã‚’å‡ºã•ãªã„
    }

    // --- é€Ÿåº¦å¤‰æ›´ã®å…±é€šå‡¦ç† ---
    // showTooltip: å…¨ç”»é¢ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ“ä½œæ™‚ã®ã¿ true ã«ã™ã‚‹
    function setSpeed(val, showTooltip = false) {
        const rate = parseFloat(val);
        
        // 1. æ•°å€¤è¡¨ç¤ºã®æ›´æ–°
        speedValue.innerText = rate.toFixed(2);
        
        // 2. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸ã®é©ç”¨
        if (player && typeof player.setPlaybackRate === 'function') {
            player.setPlaybackRate(rate);
        }

        // 3. ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼åŒæœŸ
        if (mainSpeedRange.value != val) mainSpeedRange.value = val;
        if (overlaySpeedRange.value != val) overlaySpeedRange.value = val;

        // 4. å…¨ç”»é¢ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ¨ªã®æ•°å€¤è¡¨ç¤ºå‡¦ç†
        if (showTooltip) {
            updateSliderTooltip(rate);
        }
    }

    // â–¼â–¼â–¼ è¿½åŠ ï¼šæ•°å€¤è¡¨ç¤ºã®ä½ç½®ã¨å†…å®¹ã‚’æ›´æ–°ã™ã‚‹é–¢æ•° â–¼â–¼â–¼
    function updateSliderTooltip(val) {
        // ãƒ†ã‚­ã‚¹ãƒˆæ›´æ–°
        sliderValueDisplay.innerText = val.toFixed(2) + 'x';
        
        // ä½ç½®è¨ˆç®— (min=0.25, max=2.0)
        const min = 0.25;
        const max = 2.0;
        const percent = (val - min) / (max - min);
        
        // ã‚³ãƒ³ãƒ†ãƒŠ(150px)ã®ä¸­ã§ã®ä½ç½®ã‚’ä¸‹ã‹ã‚‰ã®pxã§æŒ‡å®š
        // ä½™ç™½ãªã©ã‚’è€ƒæ…®ã—ã¦èª¿æ•´ (10px ã€œ 135pxãã‚‰ã„ã®é–“ã§å‹•ã‹ã™)
        const bottomPos = 10 + (percent * 125); 
        sliderValueDisplay.style.bottom = `${bottomPos}px`;
        
        // è¡¨ç¤ºã™ã‚‹
        sliderValueDisplay.style.opacity = '1';
        
        // ã‚¿ã‚¤ãƒãƒ¼ãƒªã‚»ãƒƒãƒˆï¼ˆæ“ä½œçµ‚äº†å¾Œã€1.5ç§’ã§æ¶ˆãˆã‚‹ï¼‰
        if (tooltipTimer) clearTimeout(tooltipTimer);
        tooltipTimer = setTimeout(() => {
            sliderValueDisplay.style.opacity = '0';
        }, 1500);
    }
    // â–²â–²â–² è¿½åŠ ã“ã“ã¾ã§ â–²â–²â–²

    // é€šå¸¸ç”»é¢ä¸‹ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ“ä½œæ™‚
    mainSpeedRange.addEventListener('input', function() {
        setSpeed(this.value, false);
    });

    // å…¨ç”»é¢ç”¨ã®ç¸¦ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ“ä½œæ™‚ï¼ˆTooltipã‚’è¡¨ç¤ºã™ã‚‹ï¼‰
    overlaySpeedRange.addEventListener('input', function() {
        setSpeed(this.value, true);
    });


    // --- å…¨ç”»é¢ï¼†æ¨ªå‘ãåˆ¶å¾¡ ---

    async function enterFullscreenLandscape() {
        if (document.documentElement.requestFullscreen) {
            try {
                await document.documentElement.requestFullscreen();
            } catch (e) { console.log("FS allowed but failed or iOS"); }
        }

        if (screen.orientation && screen.orientation.lock) {
            screen.orientation.lock('landscape').then(() => {
                videoWrapper.classList.add('is-fullscreen');
            }).catch((err) => {
                enableForceLandscape();
            });
        } else {
            enableForceLandscape();
        }
    }

    function enableForceLandscape() {
        if (window.innerWidth > window.innerHeight) {
            videoWrapper.classList.add('is-fullscreen');
        } else {
            videoWrapper.classList.add('force-landscape');
        }
    }

    function exitFullscreenLandscape() {
        if (document.fullscreenElement || document.webkitIsFullScreen) {
            if (document.exitFullscreen) {
                document.exitFullscreen().catch(err => console.log(err));
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            }
        }
        
        videoWrapper.classList.remove('is-fullscreen');
        videoWrapper.classList.remove('force-landscape');
        unlock(); 
        
        if (screen.orientation && screen.orientation.unlock) {
            screen.orientation.unlock();
        }
    }

    function exitHandler() {
        if (!document.fullscreenElement && !document.webkitIsFullScreen) {
            videoWrapper.classList.remove('is-fullscreen');
            videoWrapper.classList.remove('force-landscape');
            unlock();
            
            if (screen.orientation && screen.orientation.unlock) {
                screen.orientation.unlock();
            }
        }
    }

    document.addEventListener('fullscreenchange', exitHandler);
    document.addEventListener('webkitfullscreenchange', exitHandler);

    // --- ã‚¿ãƒƒãƒãƒ­ãƒƒã‚¯åˆ¶å¾¡ ---

    function toggleLockState() {
        if (isLocked) {
            unlock();
        } else {
            lock();
        }
    }

    function lock() {
        isLocked = true;
        touchBlocker.style.display = 'block'; 
        lockControlBtn.innerText = 'ğŸ”“ è§£é™¤'; 
        lockControlBtn.style.backgroundColor = 'rgba(255, 200, 200, 0.9)'; 
    }

    function unlock() {
        isLocked = false;
        touchBlocker.style.display = 'none'; 
        lockControlBtn.innerText = 'ğŸ”’ å›ºå®š'; 
        lockControlBtn.style.backgroundColor = 'rgba(255, 255, 255, 0.8)';
    }

</script>

</body>
</html>
